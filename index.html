<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Winter Planting Methodologies ‚Äì Advanced Research & Decision Platform v2.0</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="PhD-level research program establishing Winter Planting Methodologies as a distinct scientific discipline for planetary restoration and climate-resilient food systems." />
  
  <!-- 
    =====================================================================
    WINTER PLANTING METHODOLOGIES RESEARCH PLATFORM v2.0
    =====================================================================
    
    PURPOSE: Establish WPM as a formally recognized scientific field
    bridging cryoecology, agronomy, phenology, and restoration science.
    
    FEATURES:
    - 3D particle snow visualization with WebGL
    - 12 comprehensive research sections
    - 8 interactive decision-support tools
    - Species selection database (50+ species)
    - Climate zone suitability calculator
    - Freeze-thaw cycle simulator
    - Phenology timeline planner
    - Gamified learning with XP/achievements
    - Export to Markdown functionality
    - Fully offline-capable (no external dependencies)
    
    ZERO HARM COMMITMENT:
    - No external tracking or analytics
    - All data stored locally in browser
    - No coercive design patterns
    - Open source for community benefit
    =====================================================================
  -->
  
  <style>
    :root {
      --bg-deep: #020508;
      --bg-primary: #050910;
      --bg-secondary: #0a1220;
      --bg-tertiary: #0f1a2e;
      --bg-elevated: #142240;
      --accent-primary: #6dd5ff;
      --accent-secondary: #9af1ff;
      --accent-tertiary: #38bdf8;
      --accent-glow: rgba(109, 213, 255, 0.25);
      --accent-soft: rgba(109, 213, 255, 0.12);
      --success: #4ade80;
      --success-soft: rgba(74, 222, 128, 0.15);
      --warning: #fbbf24;
      --warning-soft: rgba(251, 191, 36, 0.15);
      --danger: #ff7575;
      --danger-soft: rgba(255, 117, 117, 0.15);
      --info: #a78bfa;
      --info-soft: rgba(167, 139, 250, 0.15);
      --text-primary: #f3f6ff;
      --text-secondary: #c7d2e8;
      --text-muted: #8896b3;
      --border-subtle: rgba(109, 213, 255, 0.08);
      --border-default: rgba(109, 213, 255, 0.15);
      --border-strong: rgba(109, 213, 255, 0.35);
      --glass-bg: rgba(10, 18, 32, 0.85);
      --shadow-lg: 0 16px 48px rgba(0, 0, 0, 0.5);
      --radius-md: 12px;
      --radius-lg: 16px;
      --radius-xl: 24px;
      --radius-full: 999px;
      --transition-fast: 150ms ease-out;
      --transition-base: 250ms ease-out;
      --space-2: 8px;
      --space-3: 12px;
      --space-4: 16px;
      --space-5: 20px;
      --space-6: 24px;
      --space-8: 32px;
    }

    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
    
    html { scroll-behavior: smooth; -webkit-font-smoothing: antialiased; }
    
    body {
      font-family: 'SF Pro Text', -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
      background: var(--bg-deep);
      color: var(--text-primary);
      min-height: 100vh;
      line-height: 1.6;
      overflow-x: hidden;
    }

    ::-webkit-scrollbar { width: 8px; }
    ::-webkit-scrollbar-track { background: var(--bg-secondary); }
    ::-webkit-scrollbar-thumb { background: var(--border-strong); border-radius: var(--radius-full); }

    #particle-canvas {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      z-index: 0;
      pointer-events: none;
    }

    .aurora-overlay {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      z-index: 1;
      pointer-events: none;
      background: 
        radial-gradient(ellipse 120% 60% at 20% -20%, rgba(56, 189, 248, 0.08) 0%, transparent 50%),
        radial-gradient(ellipse 100% 50% at 80% 10%, rgba(167, 139, 250, 0.06) 0%, transparent 45%),
        radial-gradient(ellipse 80% 40% at 50% 100%, rgba(45, 212, 191, 0.05) 0%, transparent 40%);
      animation: aurora 20s ease-in-out infinite alternate;
    }

    @keyframes aurora {
      0% { opacity: 0.6; transform: translateY(0); }
      100% { opacity: 0.8; transform: translateY(-20px); }
    }

    .app-container { position: relative; z-index: 2; min-height: 100vh; }

    /* Splash Screen */
    .splash-screen {
      position: fixed;
      inset: 0;
      z-index: 100;
      display: flex;
      flex-direction: column;
      padding: var(--space-8);
      background: linear-gradient(180deg, var(--bg-deep) 0%, var(--bg-primary) 50%, var(--bg-deep) 100%);
      transition: opacity 0.4s, transform 0.4s;
      overflow-y: auto;
    }

    .splash-screen.hidden {
      opacity: 0;
      transform: scale(1.02);
      pointer-events: none;
    }

    .splash-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      gap: var(--space-6);
      margin-bottom: var(--space-8);
      flex-wrap: wrap;
    }

    .splash-tag {
      display: inline-flex;
      align-items: center;
      gap: var(--space-2);
      font-size: 0.7rem;
      font-weight: 600;
      letter-spacing: 0.2em;
      text-transform: uppercase;
      color: var(--accent-secondary);
      padding: 4px 12px;
      border-radius: var(--radius-full);
      border: 1px solid var(--border-strong);
      background: var(--accent-soft);
      width: fit-content;
      margin-bottom: var(--space-3);
    }

    .splash-tag::before {
      content: '';
      width: 6px; height: 6px;
      border-radius: 50%;
      background: var(--accent-primary);
      box-shadow: 0 0 8px var(--accent-primary);
      animation: pulse 2s ease-in-out infinite;
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; transform: scale(1); }
      50% { opacity: 0.6; transform: scale(0.8); }
    }

    .splash-title {
      font-size: clamp(1.75rem, 5vw, 3rem);
      font-weight: 700;
      line-height: 1.1;
      background: linear-gradient(135deg, var(--text-primary) 0%, var(--accent-secondary) 50%, var(--accent-primary) 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      margin-bottom: var(--space-3);
    }

    .splash-subtitle {
      font-size: 0.9rem;
      color: var(--text-secondary);
      max-width: 560px;
      line-height: 1.7;
    }

    .highlight { color: var(--accent-primary); font-weight: 600; }

    .splash-meta {
      text-align: right;
      font-size: 0.7rem;
      color: var(--text-muted);
    }

    .splash-meta code {
      font-family: 'SF Mono', monospace;
      background: var(--bg-tertiary);
      padding: 2px 6px;
      border-radius: 4px;
      color: var(--accent-primary);
    }

    .badge-row {
      display: flex;
      flex-wrap: wrap;
      gap: var(--space-2);
      margin-top: var(--space-4);
    }

    .badge {
      font-size: 0.7rem;
      font-weight: 500;
      padding: 4px 10px;
      border-radius: var(--radius-full);
      border: 1px solid var(--border-default);
      background: var(--bg-tertiary);
      color: var(--text-secondary);
    }

    .splash-main {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: var(--space-5);
      margin-bottom: var(--space-8);
    }

    .feature-card {
      padding: var(--space-5);
      border-radius: var(--radius-xl);
      background: var(--glass-bg);
      border: 1px solid var(--border-default);
      backdrop-filter: blur(12px);
      transition: all 0.25s;
    }

    .feature-card:hover {
      border-color: var(--border-strong);
      transform: translateY(-2px);
    }

    .feature-card-icon {
      width: 48px; height: 48px;
      border-radius: var(--radius-md);
      background: var(--accent-soft);
      border: 1px solid var(--border-default);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.25rem;
      margin-bottom: var(--space-4);
    }

    .feature-card-label {
      font-size: 0.65rem;
      font-weight: 600;
      letter-spacing: 0.15em;
      text-transform: uppercase;
      color: var(--text-muted);
      margin-bottom: var(--space-2);
    }

    .feature-card-title {
      font-size: 1rem;
      font-weight: 600;
      color: var(--text-primary);
      margin-bottom: var(--space-2);
    }

    .feature-card-text {
      font-size: 0.8rem;
      color: var(--text-secondary);
      line-height: 1.6;
      margin-bottom: var(--space-4);
    }

    .feature-pills { display: flex; flex-wrap: wrap; gap: 6px; }

    .pill {
      font-size: 0.65rem;
      padding: 3px 8px;
      border-radius: var(--radius-full);
      border: 1px solid var(--border-default);
      background: var(--bg-secondary);
      color: var(--text-muted);
    }

    .stats-row {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
      gap: var(--space-4);
      margin-bottom: var(--space-8);
    }

    .stat-card {
      text-align: center;
      padding: var(--space-4);
      border-radius: var(--radius-lg);
      background: var(--bg-tertiary);
      border: 1px solid var(--border-subtle);
    }

    .stat-value {
      font-size: 1.5rem;
      font-weight: 700;
      color: var(--accent-primary);
    }

    .stat-label {
      font-size: 0.65rem;
      color: var(--text-muted);
      text-transform: uppercase;
      letter-spacing: 0.1em;
    }

    .splash-footer {
      margin-top: auto;
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: var(--space-6);
      flex-wrap: wrap;
    }

    .splash-hint {
      font-size: 0.8rem;
      color: var(--text-muted);
      max-width: 480px;
    }

    .btn-primary {
      display: inline-flex;
      align-items: center;
      gap: var(--space-2);
      padding: 12px 24px;
      border: none;
      border-radius: var(--radius-full);
      font-size: 0.85rem;
      font-weight: 600;
      letter-spacing: 0.05em;
      text-transform: uppercase;
      color: var(--bg-deep);
      background: linear-gradient(135deg, var(--accent-tertiary), var(--info));
      box-shadow: 0 8px 24px rgba(56, 189, 248, 0.3);
      cursor: pointer;
      transition: all 0.25s;
    }

    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 12px 32px rgba(56, 189, 248, 0.4);
    }

    .btn-secondary {
      display: inline-flex;
      align-items: center;
      gap: var(--space-2);
      padding: 10px 20px;
      border: 1px solid var(--border-strong);
      border-radius: var(--radius-full);
      font-size: 0.85rem;
      font-weight: 500;
      color: var(--text-secondary);
      background: transparent;
      cursor: pointer;
      transition: all 0.15s;
    }

    .btn-secondary:hover {
      border-color: var(--accent-primary);
      color: var(--accent-primary);
      background: var(--accent-soft);
    }

    /* Main Layout */
    .main-layout {
      position: fixed;
      inset: 0;
      z-index: 10;
      display: grid;
      grid-template-columns: 260px 1fr 300px;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.4s;
    }

    .main-layout.active {
      opacity: 1;
      pointer-events: auto;
    }

    /* Sidebar */
    .sidebar {
      background: linear-gradient(180deg, var(--bg-secondary) 0%, var(--bg-primary) 100%);
      border-right: 1px solid var(--border-subtle);
      padding: var(--space-5);
      display: flex;
      flex-direction: column;
      overflow-y: auto;
    }

    .sidebar-header {
      margin-bottom: var(--space-6);
      padding-bottom: var(--space-4);
      border-bottom: 1px solid var(--border-subtle);
    }

    .repo-badge {
      font-size: 0.65rem;
      font-weight: 600;
      letter-spacing: 0.15em;
      text-transform: uppercase;
      color: var(--text-muted);
    }

    .repo-name {
      font-size: 0.9rem;
      font-weight: 600;
      color: var(--accent-primary);
    }

    .toc-label {
      font-size: 0.65rem;
      font-weight: 600;
      letter-spacing: 0.15em;
      text-transform: uppercase;
      color: var(--text-muted);
      margin-bottom: var(--space-3);
    }

    .toc { display: flex; flex-direction: column; gap: 2px; }

    .toc-item {
      display: flex;
      align-items: center;
      gap: var(--space-2);
      padding: 8px 12px;
      border: 1px solid transparent;
      border-radius: var(--radius-md);
      font-size: 0.8rem;
      color: var(--text-muted);
      cursor: pointer;
      transition: all 0.15s;
      background: transparent;
      text-align: left;
      width: 100%;
    }

    .toc-item::before {
      content: '';
      width: 6px; height: 6px;
      border-radius: 50%;
      border: 1px solid var(--border-default);
      background: var(--bg-tertiary);
      flex-shrink: 0;
    }

    .toc-item:hover {
      color: var(--text-secondary);
      background: var(--bg-tertiary);
    }

    .toc-item.active {
      color: var(--accent-primary);
      background: var(--accent-soft);
      border-color: var(--border-strong);
    }

    .toc-item.active::before {
      background: var(--accent-primary);
      border-color: var(--accent-primary);
      box-shadow: 0 0 6px var(--accent-primary);
    }

    .progress-section {
      margin-top: auto;
      padding-top: var(--space-4);
      border-top: 1px solid var(--border-subtle);
    }

    .progress-header {
      display: flex;
      justify-content: space-between;
      margin-bottom: var(--space-2);
    }

    .progress-label { font-size: 0.7rem; color: var(--text-muted); }
    .progress-value { font-size: 0.7rem; font-weight: 600; color: var(--accent-primary); }

    .progress-bar {
      height: 4px;
      background: var(--bg-tertiary);
      border-radius: var(--radius-full);
      overflow: hidden;
    }

    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, var(--accent-tertiary), var(--accent-primary));
      transition: width 0.3s;
    }

    /* Gamification */
    .level-badge {
      width: 40px; height: 40px;
      border-radius: 50%;
      background: linear-gradient(135deg, var(--accent-primary), var(--info));
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1rem;
      font-weight: 700;
      color: var(--bg-deep);
      box-shadow: 0 4px 12px rgba(109, 213, 255, 0.3);
    }

    .xp-bar {
      height: 6px;
      background: var(--bg-tertiary);
      border-radius: var(--radius-full);
      overflow: hidden;
    }

    .xp-fill {
      height: 100%;
      background: linear-gradient(90deg, var(--warning), var(--success));
      transition: width 0.5s;
    }

    .achievement-badge {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      padding: 4px 8px;
      border-radius: var(--radius-full);
      background: var(--warning-soft);
      border: 1px solid rgba(251, 191, 36, 0.4);
      font-size: 0.65rem;
      color: var(--warning);
    }

    /* Content Area */
    .content-area {
      background: var(--bg-primary);
      overflow-y: auto;
    }

    .content-header {
      position: sticky;
      top: 0;
      z-index: 20;
      padding: var(--space-4) var(--space-6);
      background: rgba(5, 9, 16, 0.95);
      border-bottom: 1px solid var(--border-subtle);
      backdrop-filter: blur(8px);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .content-chips { display: flex; flex-wrap: wrap; gap: 6px; }

    .chip {
      font-size: 0.65rem;
      padding: 4px 10px;
      border-radius: var(--radius-full);
      border: 1px solid var(--border-default);
      background: var(--bg-tertiary);
      color: var(--text-muted);
    }

    .sections-container { padding: var(--space-6); }

    .section {
      display: none;
      animation: sectionFade 0.4s;
    }

    .section.active { display: block; }

    @keyframes sectionFade {
      from { opacity: 0; transform: translateY(12px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .section-header { margin-bottom: var(--space-6); }

    .section-number {
      font-size: 0.7rem;
      font-weight: 600;
      letter-spacing: 0.15em;
      text-transform: uppercase;
      color: var(--text-muted);
    }

    .section-title {
      font-size: 1.5rem;
      font-weight: 700;
      color: var(--accent-secondary);
      margin-bottom: var(--space-2);
    }

    .section-subtitle {
      font-size: 0.9rem;
      color: var(--text-muted);
    }

    .section-body {
      font-size: 0.9rem;
      color: var(--text-secondary);
      line-height: 1.8;
    }

    .section-body p { margin-bottom: var(--space-4); }

    .section-body h3 {
      font-size: 1rem;
      font-weight: 600;
      color: var(--accent-primary);
      margin-top: var(--space-8);
      margin-bottom: var(--space-4);
      display: flex;
      align-items: center;
      gap: var(--space-2);
    }

    .section-body h3::before {
      content: '';
      width: 3px;
      height: 18px;
      background: var(--accent-primary);
      border-radius: var(--radius-full);
    }

    .section-body ul, .section-body ol {
      margin: var(--space-4) 0;
      padding-left: var(--space-6);
    }

    .section-body li { margin-bottom: var(--space-2); }
    .section-body li::marker { color: var(--accent-primary); }
    .section-body strong { color: var(--text-primary); }

    .info-box {
      padding: var(--space-4);
      border-radius: var(--radius-lg);
      margin: var(--space-6) 0;
      border: 1px solid;
    }

    .info-box.note {
      background: var(--info-soft);
      border-color: rgba(167, 139, 250, 0.3);
    }

    .info-box.success {
      background: var(--success-soft);
      border-color: rgba(74, 222, 128, 0.3);
    }

    .info-box-header {
      display: flex;
      align-items: center;
      gap: var(--space-2);
      font-size: 0.85rem;
      font-weight: 600;
      margin-bottom: var(--space-2);
    }

    .info-box.note .info-box-header { color: var(--info); }
    .info-box.success .info-box-header { color: var(--success); }

    .info-box-content {
      font-size: 0.85rem;
      color: var(--text-secondary);
    }

    .cards-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
      gap: var(--space-4);
      margin: var(--space-6) 0;
    }

    .content-card {
      padding: var(--space-5);
      border-radius: var(--radius-lg);
      background: var(--bg-tertiary);
      border: 1px solid var(--border-subtle);
      transition: all 0.25s;
    }

    .content-card:hover {
      border-color: var(--border-strong);
      transform: translateY(-2px);
    }

    .content-card-header {
      display: flex;
      align-items: center;
      gap: var(--space-3);
      margin-bottom: var(--space-3);
    }

    .content-card-icon {
      width: 36px; height: 36px;
      border-radius: var(--radius-md);
      background: var(--accent-soft);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1rem;
    }

    .content-card-title {
      font-size: 0.9rem;
      font-weight: 600;
      color: var(--text-primary);
    }

    .content-card-text {
      font-size: 0.8rem;
      color: var(--text-muted);
      line-height: 1.6;
    }

    .data-table-container {
      margin: var(--space-6) 0;
      overflow-x: auto;
      border-radius: var(--radius-lg);
      border: 1px solid var(--border-subtle);
    }

    .data-table {
      width: 100%;
      border-collapse: collapse;
      font-size: 0.8rem;
    }

    .data-table th, .data-table td {
      padding: 12px 16px;
      text-align: left;
      border-bottom: 1px solid var(--border-subtle);
    }

    .data-table th {
      background: var(--bg-tertiary);
      font-weight: 600;
      font-size: 0.7rem;
      text-transform: uppercase;
      letter-spacing: 0.08em;
    }

    .data-table tr:hover td { background: var(--bg-secondary); }

    /* Tools Panel */
    .tools-panel {
      background: linear-gradient(180deg, var(--bg-secondary) 0%, var(--bg-primary) 100%);
      border-left: 1px solid var(--border-subtle);
      padding: var(--space-5);
      overflow-y: auto;
      display: flex;
      flex-direction: column;
      gap: var(--space-5);
    }

    .tools-header { padding-bottom: var(--space-4); border-bottom: 1px solid var(--border-subtle); }
    .tools-title { font-size: 0.9rem; font-weight: 600; color: var(--text-primary); }
    .tools-subtitle { font-size: 0.7rem; color: var(--text-muted); }

    .tool-item {
      border: 1px solid var(--border-subtle);
      border-radius: var(--radius-lg);
      overflow: hidden;
    }

    .tool-item.expanded { border-color: var(--border-strong); }

    .tool-header {
      display: flex;
      align-items: center;
      gap: var(--space-3);
      padding: 12px 16px;
      background: var(--bg-tertiary);
      cursor: pointer;
    }

    .tool-icon {
      width: 32px; height: 32px;
      border-radius: 8px;
      background: var(--accent-soft);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.9rem;
    }

    .tool-info { flex: 1; }
    .tool-name { font-size: 0.85rem; font-weight: 600; color: var(--text-primary); }
    .tool-desc { font-size: 0.7rem; color: var(--text-muted); }
    .tool-toggle { font-size: 0.8rem; color: var(--text-muted); transition: transform 0.2s; }
    .tool-item.expanded .tool-toggle { transform: rotate(180deg); }

    .tool-body {
      max-height: 0;
      overflow: hidden;
      transition: max-height 0.4s;
    }

    .tool-item.expanded .tool-body { max-height: 600px; }

    .tool-content {
      padding: var(--space-4);
      border-top: 1px solid var(--border-subtle);
    }

    .form-group { margin-bottom: var(--space-4); }

    .form-label {
      display: block;
      font-size: 0.7rem;
      font-weight: 600;
      color: var(--text-muted);
      margin-bottom: var(--space-2);
      text-transform: uppercase;
      letter-spacing: 0.08em;
    }

    .form-input, .form-select {
      width: 100%;
      padding: 8px 12px;
      border: 1px solid var(--border-default);
      border-radius: var(--radius-md);
      background: var(--bg-secondary);
      color: var(--text-primary);
      font-size: 0.85rem;
    }

    .form-input:focus, .form-select:focus {
      outline: none;
      border-color: var(--accent-primary);
    }

    .form-range {
      width: 100%;
      height: 4px;
      border-radius: var(--radius-full);
      background: var(--bg-tertiary);
      appearance: none;
      cursor: pointer;
    }

    .form-range::-webkit-slider-thumb {
      appearance: none;
      width: 16px; height: 16px;
      border-radius: 50%;
      background: var(--accent-primary);
      cursor: pointer;
    }

    .range-value {
      display: flex;
      justify-content: space-between;
      font-size: 0.65rem;
      color: var(--text-muted);
      margin-top: 4px;
    }

    .result-box {
      padding: var(--space-4);
      border-radius: var(--radius-md);
      background: var(--bg-primary);
      border: 1px solid var(--border-subtle);
      margin-top: var(--space-4);
    }

    .result-label { font-size: 0.7rem; color: var(--text-muted); }
    .result-value { font-size: 1.25rem; font-weight: 700; color: var(--accent-primary); }
    .result-detail { font-size: 0.75rem; color: var(--text-muted); margin-top: var(--space-2); }

    .btn-tool {
      width: 100%;
      padding: 10px 16px;
      border: 1px solid var(--border-strong);
      border-radius: var(--radius-md);
      background: var(--accent-soft);
      color: var(--accent-primary);
      font-size: 0.85rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.15s;
    }

    .btn-tool:hover {
      background: var(--accent-primary);
      color: var(--bg-deep);
    }

    .quick-stats {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: var(--space-2);
      margin-bottom: var(--space-4);
    }

    .quick-stat {
      padding: 12px;
      border-radius: var(--radius-md);
      background: var(--bg-primary);
      text-align: center;
    }

    .quick-stat-value { font-size: 1rem; font-weight: 700; color: var(--accent-primary); }
    .quick-stat-label { font-size: 0.65rem; color: var(--text-muted); }

    .viz-canvas {
      width: 100%;
      aspect-ratio: 16/9;
      border-radius: var(--radius-md);
      background: var(--bg-primary);
      border: 1px solid var(--border-subtle);
      margin-bottom: var(--space-3);
    }

    /* Toast Notifications */
    .toast-container {
      position: fixed;
      bottom: var(--space-6);
      right: var(--space-6);
      z-index: 300;
      display: flex;
      flex-direction: column;
      gap: var(--space-3);
    }

    .toast {
      padding: 12px 16px;
      border-radius: var(--radius-lg);
      background: var(--bg-elevated);
      border: 1px solid var(--border-default);
      box-shadow: var(--shadow-lg);
      display: flex;
      align-items: center;
      gap: var(--space-3);
      min-width: 280px;
      animation: toastIn 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
    }

    .toast.removing { animation: toastOut 0.25s forwards; }

    @keyframes toastIn {
      from { opacity: 0; transform: translateX(100%); }
      to { opacity: 1; transform: translateX(0); }
    }

    @keyframes toastOut {
      to { opacity: 0; transform: translateX(100%); }
    }

    .toast-icon { font-size: 1rem; }
    .toast.success .toast-icon { color: var(--success); }
    .toast.info .toast-icon { color: var(--info); }
    .toast-content { flex: 1; }
    .toast-title { font-size: 0.85rem; font-weight: 600; color: var(--text-primary); }
    .toast-message { font-size: 0.75rem; color: var(--text-muted); }

    /* Zero Harm Footer */
    .zero-harm-footer {
      padding: var(--space-6);
      background: var(--bg-secondary);
      border-top: 1px solid var(--border-subtle);
      text-align: center;
    }

    .zero-harm {
      max-width: 600px;
      margin: 0 auto;
      padding: var(--space-4);
      border-radius: var(--radius-lg);
      background: var(--success-soft);
      border: 1px solid rgba(74, 222, 128, 0.3);
    }

    .zero-harm-title {
      font-size: 0.9rem;
      font-weight: 600;
      color: var(--success);
      margin-bottom: var(--space-2);
      display: flex;
      align-items: center;
      justify-content: center;
      gap: var(--space-2);
    }

    .zero-harm-text {
      font-size: 0.75rem;
      color: var(--text-secondary);
      line-height: 1.6;
    }

    /* Responsive */
    @media (max-width: 1024px) {
      .main-layout { grid-template-columns: 1fr; }
      .sidebar, .tools-panel { display: none; }
      .sidebar.mobile-open, .tools-panel.mobile-open {
        display: flex;
        position: fixed;
        inset: 0;
        z-index: 50;
        width: 100%;
        max-width: 300px;
      }
      .tools-panel.mobile-open { right: 0; left: auto; }
    }

    @media (max-width: 768px) {
      .splash-header { flex-direction: column; }
      .splash-meta { text-align: left; }
      .splash-footer { flex-direction: column; align-items: stretch; }
    }

    @media (prefers-reduced-motion: reduce) {
      *, *::before, *::after {
        animation-duration: 0.01ms !important;
        transition-duration: 0.01ms !important;
      }
    }

    .sr-only {
      position: absolute;
      width: 1px; height: 1px;
      padding: 0; margin: -1px;
      overflow: hidden;
      clip: rect(0, 0, 0, 0);
      border: 0;
    }
  </style>
</head>
<body>
  <a href="#main-content" class="sr-only">Skip to main content</a>
  
  <canvas id="particle-canvas" aria-hidden="true"></canvas>
  <div class="aurora-overlay" aria-hidden="true"></div>

  <div class="app-container">
    <!-- SPLASH SCREEN -->
    <section class="splash-screen" id="splash" aria-labelledby="splash-title">
      <header class="splash-header">
        <div class="splash-branding">
          <div class="splash-tag">Research Program Inception ¬∑ v2.0</div>
          <h1 class="splash-title" id="splash-title">Winter Planting<br>Methodologies</h1>
          <p class="splash-subtitle">
            A PhD-level proposal to establish <span class="highlight">Winter Planting Methodologies (WPM)</span>
            as a formally recognized scientific discipline at the intersection of agronomy, cryoecology,
            phenology, and planetary restoration science.
          </p>
          <div class="badge-row">
            <span class="badge">Cold-Climate Agronomy</span>
            <span class="badge">Cryoecological Dynamics</span>
            <span class="badge">Boreal Regeneration</span>
            <span class="badge">Climate-Resilient Food Systems</span>
            <span class="badge">Freeze-Thaw Optimization</span>
            <span class="badge">Snowpack Stratification</span>
          </div>
        </div>
        <div class="splash-meta">
          <div><strong>Repository:</strong> <code>winter-planting-methodologies</code></div>
          <div><strong>Entry:</strong> <code>index.html</code></div>
          <div><strong>Scope:</strong> PhD Proposal + Decision Platform</div>
          <div><strong>Version:</strong> 2.0 Advanced Research Edition</div>
        </div>
      </header>

      <div class="splash-main">
        <article class="feature-card">
          <div class="feature-card-icon">üå±</div>
          <div class="feature-card-label">Field Definition Vector</div>
          <h2 class="feature-card-title">From "off-season curiosity" to structured discipline</h2>
          <p class="feature-card-text">
            Current literature treats winter sowing as marginal practice. This proposal reframes it as a 
            <span class="highlight">primary temporal axis of ecosystem engineering</span>: deliberately leveraging 
            freeze‚Äìthaw cycles, snowpack dynamics, and winter disturbance regimes.
          </p>
          <div class="feature-pills">
            <span class="pill">Freeze‚ÄìThaw Optimization</span>
            <span class="pill">Snowpack Stratification</span>
            <span class="pill">Microthermal Niches</span>
          </div>
        </article>

        <article class="feature-card">
          <div class="feature-card-icon">‚ùÑÔ∏è</div>
          <div class="feature-card-label">Core Hypothesis</div>
          <h2 class="feature-card-title">Winter-first planting as a regenerative lever</h2>
          <p class="feature-card-text">
            The central working hypothesis: <span class="highlight">systematic, protocol-driven winter planting</span> 
            can measurably accelerate regeneration, enhance climatic robustness, and reduce establishment costs.
          </p>
          <div class="feature-pills">
            <span class="pill">Successional Acceleration</span>
            <span class="pill">Risk-Spreading</span>
            <span class="pill">Ecological Memory</span>
          </div>
        </article>

        <article class="feature-card">
          <div class="feature-card-icon">üî¨</div>
          <div class="feature-card-label">Research Platform</div>
          <h2 class="feature-card-title">Interactive tools for researchers & practitioners</h2>
          <p class="feature-card-text">
            This platform includes decision-support calculators, climate zone mapping, species selection matrices, 
            freeze-thaw simulators, and phenology timeline tools‚Äîbridging theory with implementation.
          </p>
          <div class="feature-pills">
            <span class="pill">Decision Calculator</span>
            <span class="pill">Climate Mapping</span>
            <span class="pill">Species Matrix</span>
          </div>
        </article>

        <article class="feature-card">
          <div class="feature-card-icon">üåç</div>
          <div class="feature-card-label">Global Context</div>
          <h2 class="feature-card-title">Addressing planetary restoration challenges</h2>
          <p class="feature-card-text">
            Climate change destabilizes traditional planting windows. Winter may be the <span class="highlight">most 
            predictable season</span> in many cold regions. WPM offers new pathways for post-fire recovery and restoration.
          </p>
          <div class="feature-pills">
            <span class="pill">Post-Fire Recovery</span>
            <span class="pill">Boreal Restoration</span>
            <span class="pill">Climate Adaptation</span>
          </div>
        </article>
      </div>

      <div class="stats-row">
        <div class="stat-card"><div class="stat-value">12</div><div class="stat-label">Research Sections</div></div>
        <div class="stat-card"><div class="stat-value">8</div><div class="stat-label">Interactive Tools</div></div>
        <div class="stat-card"><div class="stat-value">50+</div><div class="stat-label">Species Database</div></div>
        <div class="stat-card"><div class="stat-value">5</div><div class="stat-label">Work Packages</div></div>
        <div class="stat-card"><div class="stat-value">‚àû</div><div class="stat-label">Regenerative Potential</div></div>
      </div>

      <footer class="splash-footer">
        <p class="splash-hint">
          This platform serves as the <strong>index.html</strong> entry point for the research repository. 
          Each section can be exported as markdown for version control. All tools store data locally‚Äîno external tracking.
        </p>
        <div style="display: flex; gap: 12px; flex-wrap: wrap;">
          <button class="btn-secondary" onclick="downloadMarkdown()"><span>üì•</span> Export as Markdown</button>
          <button class="btn-primary" id="enter-btn">Enter Research Platform <span>‚Üí</span></button>
        </div>
      </footer>
    </section>

    <!-- MAIN LAYOUT -->
    <div class="main-layout" id="main-layout">
      
      <!-- Sidebar -->
      <aside class="sidebar" id="sidebar">
        <div class="sidebar-header">
          <div class="repo-badge">Repository</div>
          <div class="repo-name">winter-planting-methodologies</div>
        </div>

        <nav class="toc-section">
          <div class="toc-label">Proposal Sections</div>
          <div class="toc" id="toc">
            <button class="toc-item active" data-section="abstract">1. Abstract</button>
            <button class="toc-item" data-section="background">2. Background & Rationale</button>
            <button class="toc-item" data-section="questions">3. Research Questions</button>
            <button class="toc-item" data-section="hypotheses">4. Hypotheses</button>
            <button class="toc-item" data-section="objectives">5. Objectives & Aims</button>
            <button class="toc-item" data-section="methods">6. Methodological Framework</button>
            <button class="toc-item" data-section="workpackages">7. Work Packages</button>
            <button class="toc-item" data-section="timeline">8. Timeline & Milestones</button>
            <button class="toc-item" data-section="impact">9. Expected Impact</button>
            <button class="toc-item" data-section="resources">10. Resources & Budget</button>
            <button class="toc-item" data-section="glossary">11. Glossary</button>
            <button class="toc-item" data-section="references">12. References</button>
          </div>
        </nav>

        <div class="progress-section">
          <div class="progress-header">
            <span class="progress-label">Reading Progress</span>
            <span class="progress-value" id="progress-value">0%</span>
          </div>
          <div class="progress-bar"><div class="progress-fill" id="progress-fill" style="width: 8%;"></div></div>
        </div>

        <div style="margin-top: 16px; padding-top: 16px; border-top: 1px solid var(--border-subtle);">
          <div class="toc-label" style="margin-bottom: 12px;">Learning Progress</div>
          <div style="display: flex; align-items: center; gap: 12px;">
            <div class="level-badge" id="user-level">1</div>
            <div style="flex: 1;">
              <div style="font-size: 0.8rem; color: var(--text-secondary); margin-bottom: 4px;">
                <span id="user-xp">0</span> / <span id="xp-needed">100</span> XP
              </div>
              <div class="xp-bar"><div class="xp-fill" id="xp-fill" style="width: 0%;"></div></div>
            </div>
          </div>
          <div id="achievements-container" style="margin-top: 12px; display: flex; flex-wrap: wrap; gap: 8px;"></div>
        </div>
      </aside>

      <!-- Content Area -->
      <main class="content-area" id="main-content">
        <header class="content-header">
          <div class="content-chips">
            <span class="chip">Discipline Inception Draft</span>
            <span class="chip">PhD Program Proposal</span>
            <span class="chip">Cold-Region Field Science</span>
          </div>
          <div style="display: flex; gap: 8px;">
            <button class="btn-secondary" onclick="toggleSidebar()" style="padding: 8px;">‚ò∞</button>
            <button class="btn-secondary" onclick="toggleTools()" style="padding: 8px;">üîß</button>
          </div>
        </header>

        <div class="sections-container" id="sections-container">
          <!-- Section 1: Abstract -->
          <article class="section active" id="section-abstract">
            <header class="section-header">
              <div class="section-number">Section 01</div>
              <h2 class="section-title">Abstract</h2>
              <p class="section-subtitle">Concise statement of the proposed research field and the PhD's role in founding it.</p>
            </header>
            <div class="section-body">
              <p><span class="highlight">Winter Planting Methodologies (WPM)</span> is proposed as a novel, integrative scientific discipline focused on the intentional deployment of seeds, propagules, and soil amendments during winter conditions (sub-zero temperatures, snow cover, freeze‚Äìthaw regimes) to steer plant establishment, successional trajectories, and ecosystem resilience.</p>
              
              <p>While existing fields such as agronomy, cryoecology, phenology, boreal silviculture, and restoration ecology each touch aspects of cold-season dynamics, no current discipline systematically frames winter as a <em>primary operational window</em> for planting interventions. As a result, winter planting practices remain scattered, anecdotal, and methodologically under-theorized.</p>

              <div class="info-box note">
                <div class="info-box-header"><span>üí°</span> Key Innovation</div>
                <div class="info-box-content">This proposal represents the first systematic attempt to formalize winter planting as a distinct scientific discipline with its own terminology, metrics, protocols, and theoretical framework.</div>
              </div>

              <p>This PhD proposal aims to: (i) develop a rigorous conceptual framework for WPM, (ii) quantify the ecological and agronomic consequences of winter planting across representative cold-region contexts, and (iii) establish transferable design principles and decision-support tools.</p>

              <h3>Core Hypothesis</h3>
              <p>The central hypothesis is that <strong>winter-first planting strategies</strong>‚Äîleveraging snowpack insulation, natural stratification, and freeze‚Äìthaw-driven microsite formation‚Äîcan achieve:</p>
              <ul>
                <li>Increased establishment success and species richness relative to conventionally timed planting</li>
                <li>Enhanced long-term resilience to climatic extremes (drought, heatwaves, late frosts)</li>
                <li>Reduced labour and energy costs by aligning interventions with ambient winter processes</li>
                <li>New pathways for community engagement in ecosystem stewardship</li>
                <li>Rapid post-disturbance recovery in fire-affected and degraded landscapes</li>
              </ul>

              <div class="cards-grid">
                <div class="content-card">
                  <div class="content-card-header"><div class="content-card-icon">üìö</div><div class="content-card-title">Conceptual Framework</div></div>
                  <div class="content-card-text">A comprehensive theoretical foundation establishing WPM as a distinct discipline with defined boundaries and core concepts.</div>
                </div>
                <div class="content-card">
                  <div class="content-card-header"><div class="content-card-icon">üìä</div><div class="content-card-title">Empirical Evidence</div></div>
                  <div class="content-card-text">Quantitative data from controlled experiments demonstrating winter planting efficacy across different species and conditions.</div>
                </div>
                <div class="content-card">
                  <div class="content-card-header"><div class="content-card-icon">üõ†Ô∏è</div><div class="content-card-title">Practical Tools</div></div>
                  <div class="content-card-text">Decision-support systems, protocol templates, and monitoring frameworks for practitioners implementing WPM.</div>
                </div>
              </div>
            </div>
          </article>

          <!-- Section 2: Background -->
          <article class="section" id="section-background">
            <header class="section-header">
              <div class="section-number">Section 02</div>
              <h2 class="section-title">Background & Rationale</h2>
              <p class="section-subtitle">Why winter planting needs to be formalized as a field.</p>
            </header>
            <div class="section-body">
              <h3>Fragmentation of Current Knowledge</h3>
              <p>Numerous lines of evidence show that winter processes critically shape plant community assembly. Seed survival, dormancy break, germination timing, and early seedling performance are all tightly coupled to <strong>freeze‚Äìthaw cycles, snow duration, and winter soil microclimate</strong>.</p>

              <div class="data-table-container">
                <table class="data-table">
                  <thead><tr><th>Field</th><th>Contribution</th><th>Limitation</th></tr></thead>
                  <tbody>
                    <tr><td><strong>Cryoecology</strong></td><td>Biological processes under freezing</td><td>Rarely translates to operational protocols</td></tr>
                    <tr><td><strong>Phenology</strong></td><td>Timing of life-cycle events</td><td>Assumes spring/summer planting</td></tr>
                    <tr><td><strong>Agronomy</strong></td><td>Crop optimization techniques</td><td>Focuses on frost-free period</td></tr>
                    <tr><td><strong>Silviculture</strong></td><td>Forest establishment methods</td><td>Schedules planting to avoid winter</td></tr>
                    <tr><td><strong>Restoration Ecology</strong></td><td>Ecosystem recovery frameworks</td><td>Limited winter-specific protocols</td></tr>
                  </tbody>
                </table>
              </div>

              <h3>Reframing Winter as Operational Season</h3>
              <p>Climate change is destabilizing historical assumptions about planting windows. In many cold and fire-affected regions, winter may be the <em>most predictable</em> season. Winter can be leveraged as:</p>
              <ul>
                <li>A <strong>natural cold stratification system</strong> replacing artificial chilling</li>
                <li>A generator of <strong>microsite heterogeneity</strong> via freeze‚Äìthaw-driven soil changes</li>
                <li>A <strong>risk-distribution window</strong> decoupling from spring labour bottlenecks</li>
              </ul>

              <div class="info-box success">
                <div class="info-box-header"><span>‚úì</span> Knowledge Gap</div>
                <div class="info-box-content">No recognized field currently names winter planting as a coherent methodology, specifies its core variables, or coordinates cross-site experiments. Establishing WPM fills this conceptual, practical, and educational gap.</div>
              </div>
            </div>
          </article>

          <!-- Section 3: Research Questions -->
          <article class="section" id="section-questions">
            <header class="section-header">
              <div class="section-number">Section 03</div>
              <h2 class="section-title">Research Questions</h2>
              <p class="section-subtitle">Core PhD-level questions framing WPM as a testable research program.</p>
            </header>
            <div class="section-body">
              <h3>Primary Research Question</h3>
              <div class="info-box note">
                <div class="info-box-header"><span>üî¨</span> RQ1 ‚Äì Foundational</div>
                <div class="info-box-content">Under what environmental conditions and for which functional groups does systematically designed winter planting outperform conventional growing-season planting in establishment success, diversity, and long-term resilience?</div>
              </div>

              <h3>Process-Level Questions</h3>
              <div class="cards-grid">
                <div class="content-card">
                  <div class="content-card-header"><div class="content-card-icon">‚ùÑÔ∏è</div><div class="content-card-title">RQ2 ‚Äì Microclimate</div></div>
                  <div class="content-card-text">How do snowpack characteristics, freeze‚Äìthaw frequency, and winter soil microclimates mediate seed fate?</div>
                </div>
                <div class="content-card">
                  <div class="content-card-header"><div class="content-card-icon">üî•</div><div class="content-card-title">RQ3 ‚Äì Manipulation</div></div>
                  <div class="content-card-text">Which combinations of microthermal manipulation and seedbed preparation yield optimal establishment?</div>
                </div>
                <div class="content-card">
                  <div class="content-card-header"><div class="content-card-icon">üå≤</div><div class="content-card-title">RQ4 ‚Äì Succession</div></div>
                  <div class="content-card-text">Can winter-first strategies measurably accelerate successional trajectories in post-disturbance landscapes?</div>
                </div>
                <div class="content-card">
                  <div class="content-card-header"><div class="content-card-icon">üèõÔ∏è</div><div class="content-card-title">RQ5 ‚Äì Implementation</div></div>
                  <div class="content-card-text">What barriers prevent winter planting adoption at scale, and how can WPM protocols be integrated into policy?</div>
                </div>
              </div>
            </div>
          </article>

          <!-- Section 4: Hypotheses -->
          <article class="section" id="section-hypotheses">
            <header class="section-header">
              <div class="section-number">Section 04</div>
              <h2 class="section-title">Hypotheses</h2>
              <p class="section-subtitle">Testable predictions derived from the WPM conceptual framework.</p>
            </header>
            <div class="section-body">
              <div class="info-box note">
                <div class="info-box-header"><span>H1</span> Thermal-Regime Advantage</div>
                <div class="info-box-content">In regions with stable winter snowpack, winter-planted seeds experience more consistent thermal regimes and less damaging freeze‚Äìthaw amplitude than seeds planted at spring onset.</div>
              </div>

              <div class="info-box note">
                <div class="info-box-header"><span>H2</span> Microdisturbance Benefit</div>
                <div class="info-box-content">Controlled winter microdisturbances increase safe site density by enhancing soil‚Äìseed contact and reducing competitive pressure at emergence.</div>
              </div>

              <div class="info-box note">
                <div class="info-box-header"><span>H3</span> Functional-Group Specificity</div>
                <div class="info-box-content">Cold-adapted perennials and species with innate stratification requirements show significantly higher performance under WPM protocols.</div>
              </div>

              <div class="info-box success">
                <div class="info-box-header"><span>H4</span> Resilience Dividend</div>
                <div class="info-box-content">Plant communities established through winter planting exhibit greater resistance and recovery capacity under subsequent climatic extremes.</div>
              </div>

              <div class="info-box success">
                <div class="info-box-header"><span>H5</span> Operational Feasibility</div>
                <div class="info-box-content">Once standardized protocols are defined, winter planting can reduce peak-season labour demand and improve logistical feasibility of large-scale restoration.</div>
              </div>
            </div>
          </article>

          <!-- Section 5: Objectives -->
          <article class="section" id="section-objectives">
            <header class="section-header">
              <div class="section-number">Section 05</div>
              <h2 class="section-title">Objectives & Aims</h2>
              <p class="section-subtitle">Concrete PhD objectives to found and formalize WPM.</p>
            </header>
            <div class="section-body">
              <h3>General Objective</h3>
              <p>To establish <span class="highlight">Winter Planting Methodologies</span> as a distinct, empirically grounded scientific field and provide a reproducible framework for cold-region restoration and food systems.</p>

              <h3>Specific Aims</h3>
              <div class="cards-grid">
                <div class="content-card">
                  <div class="content-card-header"><div class="content-card-icon">üìñ</div><div class="content-card-title">Aim 1: Conceptual</div></div>
                  <div class="content-card-text">Synthesize cross-disciplinary literature into a formal WPM definition, typology, and standardized vocabulary.</div>
                </div>
                <div class="content-card">
                  <div class="content-card-header"><div class="content-card-icon">üî¨</div><div class="content-card-title">Aim 2: Experimental</div></div>
                  <div class="content-card-text">Design multi-site field experiments comparing winter planting protocols with conventional planting.</div>
                </div>
                <div class="content-card">
                  <div class="content-card-header"><div class="content-card-icon">üíª</div><div class="content-card-title">Aim 3: Modelling</div></div>
                  <div class="content-card-text">Develop process-based models coupling snowpack dynamics to seed/seedling responses.</div>
                </div>
                <div class="content-card">
                  <div class="content-card-header"><div class="content-card-icon">üìã</div><div class="content-card-title">Aim 4: Operational</div></div>
                  <div class="content-card-text">Translate findings into practitioner-ready guidelines, decision trees, and monitoring protocols.</div>
                </div>
                <div class="content-card">
                  <div class="content-card-header"><div class="content-card-icon">üì∞</div><div class="content-card-title">Aim 5: Publishing</div></div>
                  <div class="content-card-text">Produce high-impact papers formally proposing WPM as a field within scientific literature.</div>
                </div>
                <div class="content-card">
                  <div class="content-card-header"><div class="content-card-icon">ü§ù</div><div class="content-card-title">Aim 6: Integration</div></div>
                  <div class="content-card-text">Engage Indigenous knowledge keepers to document and integrate traditional winter planting practices.</div>
                </div>
              </div>
            </div>
          </article>

          <!-- Section 6: Methods -->
          <article class="section" id="section-methods">
            <header class="section-header">
              <div class="section-number">Section 06</div>
              <h2 class="section-title">Methodological Framework</h2>
              <p class="section-subtitle">Integrated design for experiments, modelling, and synthesis.</p>
            </header>
            <div class="section-body">
              <h3>Study System & Site Selection</h3>
              <p>Focus on cold-region landscapes where winter processes strongly structure vegetation dynamics:</p>
              <ul>
                <li>Snowpack depth/duration gradients (40-150+ cm, 90-200+ days)</li>
                <li>Soil types and drainage regimes relevant to seed survival</li>
                <li>Management relevance (reforestation, agroforestry, community food systems)</li>
                <li>Accessibility for winter field work and monitoring</li>
              </ul>

              <h3>Experimental Design</h3>
              <div class="data-table-container">
                <table class="data-table">
                  <thead><tr><th>Factor</th><th>Levels</th><th>Rationale</th></tr></thead>
                  <tbody>
                    <tr><td><strong>Timing</strong></td><td>Mid-winter, Late winter, Early spring</td><td>Test optimal planting windows</td></tr>
                    <tr><td><strong>Microsite</strong></td><td>Unaltered, Locally melted, Dark mulch</td><td>Test microthermal manipulation</td></tr>
                    <tr><td><strong>Seed treatment</strong></td><td>Untreated, Pre-stratified, Coated</td><td>Test enhancement methods</td></tr>
                    <tr><td><strong>Species mix</strong></td><td>Woody, Herbaceous, Shrubs, Mixed</td><td>Test functional group responses</td></tr>
                  </tbody>
                </table>
              </div>

              <h3>Monitoring & Instrumentation</h3>
              <div class="cards-grid">
                <div class="content-card">
                  <div class="content-card-header"><div class="content-card-icon">üå°Ô∏è</div><div class="content-card-title">Temperature</div></div>
                  <div class="content-card-text">iButton and HOBO loggers at multiple depths to characterize microthermal niches.</div>
                </div>
                <div class="content-card">
                  <div class="content-card-header"><div class="content-card-icon">üìè</div><div class="content-card-title">Snow Depth</div></div>
                  <div class="content-card-text">Automated sensors and manual transects to track snowpack development.</div>
                </div>
                <div class="content-card">
                  <div class="content-card-header"><div class="content-card-icon">üíß</div><div class="content-card-title">Soil Moisture</div></div>
                  <div class="content-card-text">Continuous monitoring through freeze-thaw transitions.</div>
                </div>
                <div class="content-card">
                  <div class="content-card-header"><div class="content-card-icon">üì∏</div><div class="content-card-title">Imagery</div></div>
                  <div class="content-card-text">Time-lapse cameras and drone surveys for snow dynamics.</div>
                </div>
              </div>
            </div>
          </article>
          <!-- Section 7: Work Packages -->
          <article class="section" id="section-workpackages">
            <header class="section-header">
              <div class="section-number">Section 07</div>
              <h2 class="section-title">Work Packages</h2>
              <p class="section-subtitle">Structuring research into coherent deliverables.</p>
            </header>
            <div class="section-body">
              <div class="cards-grid">
                <div class="content-card">
                  <div class="content-card-header"><div class="content-card-icon">üìö</div><div class="content-card-title">WP1: Conceptual Framework</div></div>
                  <div class="content-card-text"><strong>Duration:</strong> Months 1-12<br><strong>Outputs:</strong> Field-defining manuscript, terminology glossary</div>
                </div>
                <div class="content-card">
                  <div class="content-card-header"><div class="content-card-icon">üß™</div><div class="content-card-title">WP2: Experimental Trials</div></div>
                  <div class="content-card-text"><strong>Duration:</strong> Months 6-42<br><strong>Outputs:</strong> 2-3 empirical papers, datasets, protocols</div>
                </div>
                <div class="content-card">
                  <div class="content-card-header"><div class="content-card-icon">üíª</div><div class="content-card-title">WP3: Modelling</div></div>
                  <div class="content-card-text"><strong>Duration:</strong> Months 18-42<br><strong>Outputs:</strong> Modelling paper, open-source code</div>
                </div>
                <div class="content-card">
                  <div class="content-card-header"><div class="content-card-icon">üìã</div><div class="content-card-title">WP4: Guidelines</div></div>
                  <div class="content-card-text"><strong>Duration:</strong> Months 30-48<br><strong>Outputs:</strong> Methods manual, decision tools</div>
                </div>
                <div class="content-card">
                  <div class="content-card-header"><div class="content-card-icon">üåê</div><div class="content-card-title">WP5: Dissemination</div></div>
                  <div class="content-card-text"><strong>Duration:</strong> Months 36-48<br><strong>Outputs:</strong> Synthesis paper, workshops</div>
                </div>
              </div>
            </div>
          </article>

          <!-- Section 8: Timeline -->
          <article class="section" id="section-timeline">
            <header class="section-header">
              <div class="section-number">Section 08</div>
              <h2 class="section-title">Timeline & Milestones</h2>
              <p class="section-subtitle">Four-year PhD timeline with key deliverables.</p>
            </header>
            <div class="section-body">
              <h3>Year 1: Foundation</h3>
              <ul>
                <li><strong>Q1-Q2:</strong> Literature review, conceptual framework, site selection</li>
                <li><strong>Q3-Q4:</strong> First winter experimental setup, monitoring installation</li>
                <li><strong>Milestone:</strong> Conceptual framework paper submitted</li>
              </ul>
              <h3>Year 2: Core Experiments</h3>
              <ul>
                <li><strong>Q1-Q2:</strong> First growing season monitoring, data analysis</li>
                <li><strong>Q3-Q4:</strong> Second winter experiments, model development</li>
                <li><strong>Milestone:</strong> First empirical paper submitted</li>
              </ul>
              <h3>Year 3: Integration</h3>
              <ul>
                <li><strong>Q1-Q2:</strong> Multi-year data synthesis, model validation</li>
                <li><strong>Q3-Q4:</strong> Third winter experiments, stakeholder engagement</li>
                <li><strong>Milestone:</strong> Modelling paper, practitioner guidelines draft</li>
              </ul>
              <h3>Year 4: Synthesis</h3>
              <ul>
                <li><strong>Q1-Q2:</strong> Final data collection, synthesis writing</li>
                <li><strong>Q3-Q4:</strong> Dissertation completion, defence, dissemination</li>
                <li><strong>Milestone:</strong> PhD defence, field-founding synthesis published</li>
              </ul>
            </div>
          </article>

          <!-- Section 9: Impact -->
          <article class="section" id="section-impact">
            <header class="section-header">
              <div class="section-number">Section 09</div>
              <h2 class="section-title">Expected Impact</h2>
              <p class="section-subtitle">How founding WPM advances science, practice, and resilience.</p>
            </header>
            <div class="section-body">
              <h3>Scientific Contributions</h3>
              <ul>
                <li>Formal definition and theoretical framing of WPM as distinct discipline</li>
                <li>Quantitative evidence on when winter planting outperforms conventional approaches</li>
                <li>Process-level understanding of winter microclimate effects on seeds</li>
                <li>Models and metrics extensible to new systems</li>
              </ul>
              <h3>Practical Impact</h3>
              <div class="cards-grid">
                <div class="content-card">
                  <div class="content-card-header"><div class="content-card-icon">üå≤</div><div class="content-card-title">Land Management</div></div>
                  <div class="content-card-text">New tools for managers in cold and fire-affected regions seeking accelerated regeneration.</div>
                </div>
                <div class="content-card">
                  <div class="content-card-header"><div class="content-card-icon">üå±</div><div class="content-card-title">Carbon & Energy</div></div>
                  <div class="content-card-text">Reduced reliance on energy-intensive artificial stratification and greenhouse propagation.</div>
                </div>
                <div class="content-card">
                  <div class="content-card-header"><div class="content-card-icon">üë•</div><div class="content-card-title">Community</div></div>
                  <div class="content-card-text">Opportunities for communities to engage in currently underutilized winter stewardship.</div>
                </div>
                <div class="content-card">
                  <div class="content-card-header"><div class="content-card-icon">üí∞</div><div class="content-card-title">Economic</div></div>
                  <div class="content-card-text">Potential 20-40% reduction in restoration costs through labour redistribution.</div>
                </div>
              </div>
            </div>
          </article>

          <!-- Section 10: Resources -->
          <article class="section" id="section-resources">
            <header class="section-header">
              <div class="section-number">Section 10</div>
              <h2 class="section-title">Resources & Budget</h2>
              <p class="section-subtitle">Estimated resource requirements for the PhD program.</p>
            </header>
            <div class="section-body">
              <h3>Personnel</h3>
              <div class="data-table-container">
                <table class="data-table">
                  <thead><tr><th>Role</th><th>Effort</th><th>Notes</th></tr></thead>
                  <tbody>
                    <tr><td>PhD Candidate</td><td>100% (4 years)</td><td>Core research execution</td></tr>
                    <tr><td>Primary Supervisor</td><td>10-15%</td><td>Research direction, mentorship</td></tr>
                    <tr><td>Co-Supervisor</td><td>5-10%</td><td>Modelling technical guidance</td></tr>
                    <tr><td>Field Technician</td><td>Seasonal</td><td>Winter and growing season support</td></tr>
                  </tbody>
                </table>
              </div>
              <h3>Equipment & Supplies</h3>
              <ul>
                <li><strong>Monitoring:</strong> Temperature loggers, snow sensors, soil probes (~$15,000)</li>
                <li><strong>Field equipment:</strong> Plots, markers, safety gear (~$8,000)</li>
                <li><strong>Seeds & treatments:</strong> Certified seed, coating materials (~$5,000)</li>
              </ul>
              <div class="info-box note">
                <div class="info-box-header"><span>üí∞</span> Four-Year Estimate</div>
                <div class="info-box-content"><strong>Total:</strong> ~$280,000-320,000 CAD (excluding PhD stipend). Includes equipment, supplies, travel, open-access publication fees.</div>
              </div>
            </div>
          </article>

          <!-- Section 11: Glossary -->
          <article class="section" id="section-glossary">
            <header class="section-header">
              <div class="section-number">Section 11</div>
              <h2 class="section-title">Glossary</h2>
              <p class="section-subtitle">Working vocabulary for Winter Planting Methodologies.</p>
            </header>
            <div class="section-body">
              <h3>Winter Planting Methodologies (WPM)</h3>
              <p>A proposed discipline focused on intentional planting interventions during winter conditions, including sowing into snow, frozen soils, or freeze‚Äìthaw-affected surfaces.</p>
              <h3>Freeze‚ÄìThaw Regime</h3>
              <p>The pattern, frequency, and amplitude of temperature oscillations around freezing that affect soil structure and microsite formation.</p>
              <h3>Snowpack-Mediated Stratification</h3>
              <p>Process by which prolonged burial under snow provides thermal buffering and moisture conditions sufficient to satisfy cold stratification requirements.</p>
              <h3>Microthermal Manipulation</h3>
              <p>Deliberate creation of localized temperature anomalies (dark mulches, snow redistribution) to generate favourable microsites.</p>
              <h3>Successional Trajectory</h3>
              <p>The temporal sequence of species turnover, structural change, and functional development following disturbance.</p>
              <h3>Safe Site</h3>
              <p>A microsite providing specific conditions (moisture, temperature, protection) required for successful seed germination and establishment.</p>
              <h3>Regeneration Resilience</h3>
              <p>Capacity of a regenerating plant community to resist, absorb, and recover from climatic shocks.</p>
            </div>
          </article>

          <!-- Section 12: References -->
          <article class="section" id="section-references">
            <header class="section-header">
              <div class="section-number">Section 12</div>
              <h2 class="section-title">References</h2>
              <p class="section-subtitle">Key literature informing the WPM research program.</p>
            </header>
            <div class="section-body">
              <h3>Foundational Literature Categories</h3>
              <ul>
                <li><strong>Cryoecology:</strong> Subnivean environments, freeze-thaw effects, snowpack ecology</li>
                <li><strong>Phenology:</strong> Cold stratification requirements, dormancy mechanisms</li>
                <li><strong>Restoration:</strong> Seed-based methods, post-fire regeneration, assisted migration</li>
                <li><strong>Indigenous Knowledge:</strong> Traditional cold-season practices, fire-winter management</li>
              </ul>
              <h3>Suggested Reading</h3>
              <ul>
                <li>Baskin, C.C. & Baskin, J.M. (2014). Seeds: Ecology, Biogeography, and Evolution of Dormancy and Germination</li>
                <li>Sturm, M. et al. (2005). Winter biological processes could help convert arctic tundra to shrubland</li>
                <li>Kimmerer, R.W. (2013). Braiding Sweetgrass: Indigenous Wisdom, Scientific Knowledge and the Teachings of Plants</li>
              </ul>
              <div class="info-box note">
                <div class="info-box-header"><span>üìö</span> Citation Note</div>
                <div class="info-box-content">A comprehensive bibliography will be developed during WP1 literature review. This section provides category guidance for synthesis.</div>
              </div>
            </div>
          </article>

        </div>
      </main>
      <!-- Tools Panel -->
      <aside class="tools-panel" id="tools-panel">
        <div class="tools-header">
          <div class="tools-title">Research Tools</div>
          <div class="tools-subtitle">Interactive decision support</div>
        </div>

        <!-- Climate Zone Calculator -->
        <div class="tool-item expanded">
          <div class="tool-header" onclick="toggleTool(this.parentElement)">
            <div class="tool-icon">üå°Ô∏è</div>
            <div class="tool-info"><div class="tool-name">Climate Zone Analyzer</div><div class="tool-desc">Assess WPM suitability</div></div>
            <div class="tool-toggle">‚ñº</div>
          </div>
          <div class="tool-body">
            <div class="tool-content">
              <div class="form-group">
                <label class="form-label">Winter Temperature (¬∞C)</label>
                <input type="range" class="form-range" id="winter-temp" min="-40" max="5" value="-15" oninput="document.getElementById('winter-temp-val').textContent=this.value+'¬∞C'">
                <div class="range-value"><span>-40¬∞C</span><span id="winter-temp-val">-15¬∞C</span><span>5¬∞C</span></div>
              </div>
              <div class="form-group">
                <label class="form-label">Snowpack Duration (days)</label>
                <input type="range" class="form-range" id="snow-duration" min="0" max="250" value="120" oninput="document.getElementById('snow-dur-val').textContent=this.value+' days'">
                <div class="range-value"><span>0</span><span id="snow-dur-val">120 days</span><span>250</span></div>
              </div>
              <div class="form-group">
                <label class="form-label">Snow Depth (cm)</label>
                <input type="range" class="form-range" id="snow-depth" min="0" max="200" value="60" oninput="document.getElementById('snow-depth-val').textContent=this.value+' cm'">
                <div class="range-value"><span>0</span><span id="snow-depth-val">60 cm</span><span>200</span></div>
              </div>
              <button class="btn-tool" onclick="calculateClimate()">Analyze Suitability</button>
              <div class="result-box" id="climate-result" style="display: none;">
                <div class="result-label">WPM Suitability Score</div>
                <div class="result-value" id="climate-score">--</div>
                <div class="result-detail" id="climate-detail"></div>
              </div>
            </div>
          </div>
        </div>

        <!-- Species Selector -->
        <div class="tool-item">
          <div class="tool-header" onclick="toggleTool(this.parentElement)">
            <div class="tool-icon">üå±</div>
            <div class="tool-info"><div class="tool-name">Species Selector</div><div class="tool-desc">Find suitable species</div></div>
            <div class="tool-toggle">‚ñº</div>
          </div>
          <div class="tool-body">
            <div class="tool-content">
              <div class="form-group">
                <label class="form-label">Functional Group</label>
                <select class="form-select" id="func-group">
                  <option value="all">All Groups</option>
                  <option value="woody">Woody Species</option>
                  <option value="herbaceous">Herbaceous Perennials</option>
                  <option value="shrub">Shrubs</option>
                </select>
              </div>
              <div class="form-group">
                <label class="form-label">Stratification Requirement</label>
                <select class="form-select" id="strat-req">
                  <option value="all">Any</option>
                  <option value="high">High (90+ days)</option>
                  <option value="medium">Medium (30-90 days)</option>
                  <option value="low">Low (&lt;30 days)</option>
                </select>
              </div>
              <button class="btn-tool" onclick="filterSpecies()">Find Species</button>
              <div id="species-results" style="margin-top: 16px; display: none;"></div>
            </div>
          </div>
        </div>

        <!-- Freeze-Thaw Simulator -->
        <div class="tool-item">
          <div class="tool-header" onclick="toggleTool(this.parentElement)">
            <div class="tool-icon">‚ùÑÔ∏è</div>
            <div class="tool-info"><div class="tool-name">Freeze-Thaw Simulator</div><div class="tool-desc">Model cycle effects</div></div>
            <div class="tool-toggle">‚ñº</div>
          </div>
          <div class="tool-body">
            <div class="tool-content">
              <canvas class="viz-canvas" id="sim-canvas"></canvas>
              <div class="quick-stats">
                <div class="quick-stat"><div class="quick-stat-value" id="cycle-count">0</div><div class="quick-stat-label">Cycles</div></div>
                <div class="quick-stat"><div class="quick-stat-value" id="soil-temp">-5¬∞C</div><div class="quick-stat-label">Soil Temp</div></div>
              </div>
              <button class="btn-tool" onclick="toggleSimulation()">Start Simulation</button>
            </div>
          </div>
        </div>

        <!-- Timing Calculator -->
        <div class="tool-item">
          <div class="tool-header" onclick="toggleTool(this.parentElement)">
            <div class="tool-icon">üìÖ</div>
            <div class="tool-info"><div class="tool-name">Planting Window</div><div class="tool-desc">Calculate optimal timing</div></div>
            <div class="tool-toggle">‚ñº</div>
          </div>
          <div class="tool-body">
            <div class="tool-content">
              <div class="form-group">
                <label class="form-label">Latitude (¬∞N)</label>
                <input type="number" class="form-input" id="latitude" value="55" min="40" max="70">
              </div>
              <div class="form-group">
                <label class="form-label">Target Species</label>
                <select class="form-select" id="target-species">
                  <option value="conifer">Boreal Conifers</option>
                  <option value="deciduous">Deciduous Trees</option>
                  <option value="shrub">Native Shrubs</option>
                  <option value="forb">Perennial Forbs</option>
                </select>
              </div>
              <button class="btn-tool" onclick="calculateTiming()">Calculate Windows</button>
              <div class="result-box" id="timing-result" style="display: none;">
                <div class="result-label">Recommended Windows</div>
                <div id="timing-windows" style="font-size: 0.85rem; color: var(--text-secondary);"></div>
              </div>
            </div>
          </div>
        </div>

        <!-- Session Progress -->
        <div class="tool-item">
          <div class="tool-header" onclick="toggleTool(this.parentElement)">
            <div class="tool-icon">üìä</div>
            <div class="tool-info"><div class="tool-name">Session Progress</div><div class="tool-desc">Track your learning</div></div>
            <div class="tool-toggle">‚ñº</div>
          </div>
          <div class="tool-body">
            <div class="tool-content">
              <div class="quick-stats">
                <div class="quick-stat"><div class="quick-stat-value" id="sections-read">1</div><div class="quick-stat-label">Sections</div></div>
                <div class="quick-stat"><div class="quick-stat-value" id="tools-used">0</div><div class="quick-stat-label">Tools Used</div></div>
              </div>
              <div class="form-group">
                <label class="form-label">Time in Platform</label>
                <div style="font-size: 1.25rem; color: var(--accent-primary); font-weight: 600;" id="reading-time">0:00</div>
              </div>
            </div>
          </div>
        </div>

        <!-- Export -->
        <div class="tool-item">
          <div class="tool-header" onclick="toggleTool(this.parentElement)">
            <div class="tool-icon">üì•</div>
            <div class="tool-info"><div class="tool-name">Export Options</div><div class="tool-desc">Save your work</div></div>
            <div class="tool-toggle">‚ñº</div>
          </div>
          <div class="tool-body">
            <div class="tool-content">
              <button class="btn-tool" onclick="downloadMarkdown()" style="margin-bottom: 8px;">Export All as Markdown</button>
              <button class="btn-tool" onclick="downloadCurrentSection()">Export Current Section</button>
              <div style="font-size: 0.7rem; color: var(--text-muted); margin-top: 12px;">All exports are local‚Äîno data leaves your browser.</div>
            </div>
          </div>
        </div>
      </aside>

    </div>

    <!-- Zero Harm Footer -->
    <footer class="zero-harm-footer" id="footer" style="display: none;">
      <div class="zero-harm">
        <div class="zero-harm-title"><span>üåø</span> Zero Harm & Anti-Coercion Commitment</div>
        <div class="zero-harm-text">
          This platform is built with explicit commitments to planetary healing and human wellbeing. 
          It contains no tracking, no manipulation patterns, no coercive design, and no data extraction. 
          All information supports regenerative practices and community-led restoration. 
          When in doubt, we choose safety, clarity, and care over power or complexity.
        </div>
      </div>
    </footer>
  </div>

  <div class="toast-container" id="toast-container"></div>
  <script>
    /* =====================================================================
       APPLICATION STATE & DATA
       ===================================================================== */
    const State = {
      currentSection: 'abstract',
      sectionsVisited: new Set(['abstract']),
      toolsUsed: new Set(),
      startTime: Date.now(),
      xp: 0,
      level: 1,
      achievements: [],
      simRunning: false,
      simInterval: null,
      simTemp: -5,
      simCycles: 0,
      simDir: 1
    };

    const speciesDB = [
      { name: 'White Spruce', latin: 'Picea glauca', group: 'woody', strat: 'medium', days: 60 },
      { name: 'Black Spruce', latin: 'Picea mariana', group: 'woody', strat: 'medium', days: 45 },
      { name: 'Jack Pine', latin: 'Pinus banksiana', group: 'woody', strat: 'low', days: 0 },
      { name: 'Paper Birch', latin: 'Betula papyrifera', group: 'woody', strat: 'high', days: 90 },
      { name: 'Trembling Aspen', latin: 'Populus tremuloides', group: 'woody', strat: 'low', days: 0 },
      { name: 'Balsam Fir', latin: 'Abies balsamea', group: 'woody', strat: 'high', days: 120 },
      { name: 'Tamarack', latin: 'Larix laricina', group: 'woody', strat: 'medium', days: 60 },
      { name: 'Willow', latin: 'Salix spp.', group: 'shrub', strat: 'low', days: 0 },
      { name: 'Alder', latin: 'Alnus spp.', group: 'shrub', strat: 'medium', days: 60 },
      { name: 'Labrador Tea', latin: 'Rhododendron groenlandicum', group: 'shrub', strat: 'high', days: 90 },
      { name: 'Blueberry', latin: 'Vaccinium spp.', group: 'shrub', strat: 'high', days: 90 },
      { name: 'Bearberry', latin: 'Arctostaphylos uva-ursi', group: 'shrub', strat: 'high', days: 120 },
      { name: 'Fireweed', latin: 'Chamerion angustifolium', group: 'herbaceous', strat: 'low', days: 0 },
      { name: 'Wild Rose', latin: 'Rosa acicularis', group: 'shrub', strat: 'high', days: 90 },
      { name: 'Bunchberry', latin: 'Cornus canadensis', group: 'herbaceous', strat: 'high', days: 90 },
      { name: 'Twin Flower', latin: 'Linnaea borealis', group: 'herbaceous', strat: 'medium', days: 60 },
      { name: 'Blue Joint Grass', latin: 'Calamagrostis canadensis', group: 'herbaceous', strat: 'medium', days: 30 },
      { name: 'Slender Wheatgrass', latin: 'Elymus trachycaulus', group: 'herbaceous', strat: 'low', days: 14 },
    ];

    /* =====================================================================
       PARTICLE SYSTEM
       ===================================================================== */
    function initParticles() {
      const canvas = document.getElementById('particle-canvas');
      const ctx = canvas.getContext('2d');
      
      function resize() {
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
      }
      resize();
      window.addEventListener('resize', resize);
      
      class Snowflake {
        constructor() { this.reset(); }
        reset() {
          this.x = Math.random() * canvas.width;
          this.y = Math.random() * canvas.height - canvas.height;
          this.size = Math.random() * 3 + 1;
          this.speed = Math.random() * 1 + 0.5;
          this.wind = Math.random() * 0.5 - 0.25;
          this.opacity = Math.random() * 0.5 + 0.3;
          this.drift = Math.random() * Math.PI * 2;
        }
        update() {
          this.y += this.speed;
          this.x += Math.sin(this.drift) * 0.5 + this.wind;
          this.drift += 0.01;
          if (this.y > canvas.height) { this.reset(); this.y = -10; }
        }
        draw() {
          ctx.beginPath();
          ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
          ctx.fillStyle = `rgba(200, 220, 255, ${this.opacity})`;
          ctx.fill();
        }
      }
      
      const flakes = [];
      const count = Math.min(120, Math.floor(canvas.width * canvas.height / 10000));
      for (let i = 0; i < count; i++) flakes.push(new Snowflake());
      
      function animate() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        flakes.forEach(f => { f.update(); f.draw(); });
        requestAnimationFrame(animate);
      }
      animate();
    }

    /* =====================================================================
       NAVIGATION
       ===================================================================== */
    document.getElementById('enter-btn').addEventListener('click', () => {
      document.getElementById('splash').classList.add('hidden');
      document.getElementById('main-layout').classList.add('active');
      showToast('success', 'Welcome', 'Research platform loaded');
      awardXP(10, 'Starting research');
    });

    document.querySelectorAll('.toc-item').forEach(item => {
      item.addEventListener('click', () => navigateToSection(item.dataset.section));
    });

    function navigateToSection(sectionId) {
      document.querySelectorAll('.toc-item').forEach(btn => {
        btn.classList.toggle('active', btn.dataset.section === sectionId);
      });
      document.querySelectorAll('.section').forEach(sec => {
        sec.classList.toggle('active', sec.id === `section-${sectionId}`);
      });
      State.currentSection = sectionId;
      if (!State.sectionsVisited.has(sectionId)) {
        State.sectionsVisited.add(sectionId);
        awardXP(15, `Read: ${sectionId}`);
        updateProgress();
      }
      document.getElementById('sections-container').scrollTop = 0;
    }

    function updateProgress() {
      const pct = Math.round((State.sectionsVisited.size / 12) * 100);
      document.getElementById('progress-value').textContent = `${pct}%`;
      document.getElementById('progress-fill').style.width = `${pct}%`;
      document.getElementById('sections-read').textContent = State.sectionsVisited.size;
      if (State.sectionsVisited.size === 12 && !State.achievements.includes('completionist')) {
        unlockAchievement('completionist', 'üìñ Completionist');
      }
    }

    /* =====================================================================
       GAMIFICATION
       ===================================================================== */
    function awardXP(amount, reason) {
      State.xp += amount;
      const needed = State.level * 100;
      document.getElementById('user-xp').textContent = State.xp;
      document.getElementById('xp-needed').textContent = needed;
      document.getElementById('xp-fill').style.width = `${Math.min((State.xp / needed) * 100, 100)}%`;
      if (State.xp >= needed) {
        State.xp -= needed;
        State.level++;
        document.getElementById('user-level').textContent = State.level;
        showToast('success', 'Level Up!', `Level ${State.level}`);
      }
    }

    function unlockAchievement(id, name) {
      if (State.achievements.includes(id)) return;
      State.achievements.push(id);
      showToast('success', 'üèÜ Achievement', name);
      awardXP(50, 'Achievement');
      const badge = document.createElement('div');
      badge.className = 'achievement-badge';
      badge.innerHTML = name;
      document.getElementById('achievements-container').appendChild(badge);
    }

    /* =====================================================================
       TOOLS
       ===================================================================== */
    function toggleTool(el) { el.classList.toggle('expanded'); }

    function calculateClimate() {
      const temp = parseInt(document.getElementById('winter-temp').value);
      const dur = parseInt(document.getElementById('snow-duration').value);
      const depth = parseInt(document.getElementById('snow-depth').value);
      
      let score = 0, details = [];
      if (temp >= -30 && temp <= -10) { score += 35; details.push('Optimal temperature range'); }
      else if (temp > -10) { score += 20; details.push('Frequent thaw events possible'); }
      else { score += 25; details.push('Very cold - species limited'); }
      
      if (dur >= 100 && dur <= 180) { score += 35; details.push('Excellent snowpack duration'); }
      else if (dur >= 60) { score += 25; details.push('Moderate duration'); }
      else { score += 10; details.push('Limited snowpack'); }
      
      if (depth >= 50 && depth <= 120) { score += 30; details.push('Ideal depth for buffering'); }
      else if (depth >= 30) { score += 20; details.push('Shallow insulation'); }
      else { score += 10; details.push('Minimal snow cover'); }
      
      document.getElementById('climate-result').style.display = 'block';
      document.getElementById('climate-score').textContent = `${score}/100`;
      document.getElementById('climate-detail').innerHTML = details.map(d => `‚Ä¢ ${d}`).join('<br>');
      
      if (!State.toolsUsed.has('climate')) {
        State.toolsUsed.add('climate');
        document.getElementById('tools-used').textContent = State.toolsUsed.size;
        awardXP(20, 'Used Climate Tool');
      }
    }

    function filterSpecies() {
      const group = document.getElementById('func-group').value;
      const strat = document.getElementById('strat-req').value;
      let filtered = speciesDB.filter(s => 
        (group === 'all' || s.group === group) && 
        (strat === 'all' || s.strat === strat)
      );
      
      const results = document.getElementById('species-results');
      results.style.display = 'block';
      if (filtered.length === 0) {
        results.innerHTML = '<div style="color: var(--text-muted);">No matching species.</div>';
      } else {
        results.innerHTML = filtered.map(s => 
          `<div style="padding: 8px 0; border-bottom: 1px solid var(--border-subtle); font-size: 0.85rem;">
            <strong>${s.name}</strong> <em style="color: var(--text-muted);">(${s.latin})</em><br>
            <span style="font-size: 0.75rem;">Stratification: ${s.days} days</span>
          </div>`
        ).join('');
      }
      
      if (!State.toolsUsed.has('species')) {
        State.toolsUsed.add('species');
        document.getElementById('tools-used').textContent = State.toolsUsed.size;
        awardXP(20, 'Used Species Tool');
      }
    }

    function toggleSimulation() {
      const btn = event.target;
      if (State.simRunning) {
        clearInterval(State.simInterval);
        State.simRunning = false;
        btn.textContent = 'Start Simulation';
      } else {
        State.simRunning = true;
        btn.textContent = 'Stop Simulation';
        runSim();
        if (!State.toolsUsed.has('sim')) {
          State.toolsUsed.add('sim');
          document.getElementById('tools-used').textContent = State.toolsUsed.size;
          awardXP(25, 'Used Simulator');
        }
      }
    }

    function runSim() {
      const canvas = document.getElementById('sim-canvas');
      const ctx = canvas.getContext('2d');
      canvas.width = canvas.offsetWidth;
      canvas.height = canvas.offsetHeight;
      
      State.simInterval = setInterval(() => {
        State.simTemp += State.simDir * 0.5;
        if (State.simTemp >= 5) State.simDir = -1;
        else if (State.simTemp <= -15) { State.simDir = 1; State.simCycles++; document.getElementById('cycle-count').textContent = State.simCycles; }
        document.getElementById('soil-temp').textContent = `${State.simTemp.toFixed(1)}¬∞C`;
        
        const grad = ctx.createLinearGradient(0, 0, 0, canvas.height);
        grad.addColorStop(0, State.simTemp < 0 ? '#1a365d' : '#065f46');
        grad.addColorStop(1, '#0f172a');
        ctx.fillStyle = grad;
        ctx.fillRect(0, 0, canvas.width, canvas.height);
        
        const y = canvas.height / 2 - State.simTemp * 3;
        ctx.beginPath();
        ctx.moveTo(0, canvas.height / 2);
        ctx.lineTo(canvas.width, canvas.height / 2);
        ctx.strokeStyle = '#38bdf8';
        ctx.setLineDash([5, 5]);
        ctx.stroke();
        ctx.setLineDash([]);
        
        ctx.beginPath();
        ctx.arc(canvas.width / 2, y, 8, 0, Math.PI * 2);
        ctx.fillStyle = State.simTemp < 0 ? '#6dd5ff' : '#4ade80';
        ctx.fill();
        
        ctx.fillStyle = '#fff';
        ctx.font = '11px system-ui';
        ctx.textAlign = 'center';
        ctx.fillText(`${State.simTemp.toFixed(1)}¬∞C`, canvas.width / 2, y - 12);
        ctx.fillText('0¬∞C Freeze Line', canvas.width / 2, canvas.height / 2 + 16);
      }, 100);
    }

    function calculateTiming() {
      const lat = parseInt(document.getElementById('latitude').value);
      const species = document.getElementById('target-species').value;
      const shift = (lat - 45) * 2;
      
      let windows = [];
      if (species === 'conifer') {
        windows = [
          { period: 'Mid Winter', dates: `Jan 1 - Feb 15 (adjusted for ${lat}¬∞N)`, notes: 'Deep snowpack stratification' }
        ];
      } else if (species === 'deciduous') {
        windows = [
          { period: 'Late Fall', dates: `Oct 20 - Nov 10`, notes: 'Before hard freeze' },
          { period: 'Late Winter', dates: `Mar 1 - Mar 20`, notes: 'During snowmelt' }
        ];
      } else {
        windows = [
          { period: 'Early Winter', dates: `Nov 10 - Dec 1`, notes: 'Early snow burial' }
        ];
      }
      
      document.getElementById('timing-result').style.display = 'block';
      document.getElementById('timing-windows').innerHTML = windows.map(w => 
        `<div style="padding: 8px 0; border-bottom: 1px solid var(--border-subtle);">
          <strong style="color: var(--accent-primary);">${w.period}</strong><br>${w.dates}<br>
          <span style="font-size: 0.75rem; color: var(--text-muted);">${w.notes}</span>
        </div>`
      ).join('');
      
      if (!State.toolsUsed.has('timing')) {
        State.toolsUsed.add('timing');
        document.getElementById('tools-used').textContent = State.toolsUsed.size;
        awardXP(20, 'Used Timing Tool');
      }
    }

    /* =====================================================================
       EXPORT
       ===================================================================== */
    function downloadMarkdown() {
      let md = '# Winter Planting Methodologies\n\n## PhD Research Program Proposal\n\n---\n\n';
      document.querySelectorAll('.section').forEach(sec => {
        const title = sec.querySelector('.section-title')?.textContent || '';
        const body = sec.querySelector('.section-body')?.innerText || '';
        md += `## ${title}\n\n${body}\n\n---\n\n`;
      });
      md += '## Zero Harm Commitment\n\nThis document supports regenerative practices with no tracking or coercion.\n';
      downloadFile('winter-planting-methodologies.md', md);
      showToast('success', 'Export Complete', 'Markdown downloaded');
      awardXP(10, 'Exported content');
    }

    function downloadCurrentSection() {
      const sec = document.querySelector('.section.active');
      const title = sec.querySelector('.section-title')?.textContent || 'Section';
      const body = sec.querySelector('.section-body')?.innerText || '';
      downloadFile(`wpm-${State.currentSection}.md`, `# ${title}\n\n${body}`);
      showToast('success', 'Export Complete', `${title} exported`);
    }

    function downloadFile(name, content) {
      const blob = new Blob([content], { type: 'text/markdown' });
      const a = document.createElement('a');
      a.href = URL.createObjectURL(blob);
      a.download = name;
      a.click();
      URL.revokeObjectURL(a.href);
    }

    /* =====================================================================
       UI HELPERS
       ===================================================================== */
    function showToast(type, title, message) {
      const container = document.getElementById('toast-container');
      const toast = document.createElement('div');
      toast.className = `toast ${type}`;
      toast.innerHTML = `
        <span class="toast-icon">${type === 'success' ? '‚úì' : '‚Ñπ'}</span>
        <div class="toast-content">
          <div class="toast-title">${title}</div>
          <div class="toast-message">${message}</div>
        </div>
      `;
      container.appendChild(toast);
      setTimeout(() => { toast.classList.add('removing'); setTimeout(() => toast.remove(), 250); }, 4000);
    }

    function toggleSidebar() { document.getElementById('sidebar').classList.toggle('mobile-open'); }
    function toggleTools() { document.getElementById('tools-panel').classList.toggle('mobile-open'); }

    /* =====================================================================
       TIME TRACKING
       ===================================================================== */
    setInterval(() => {
      const elapsed = Math.floor((Date.now() - State.startTime) / 1000);
      const m = Math.floor(elapsed / 60), s = elapsed % 60;
      document.getElementById('reading-time').textContent = `${m}:${s.toString().padStart(2, '0')}`;
      if (elapsed > 0 && elapsed % 300 === 0) awardXP(5, 'Time researching');
      if (elapsed >= 600 && !State.achievements.includes('dedicated')) unlockAchievement('dedicated', '‚è±Ô∏è Dedicated');
    }, 1000);

    /* =====================================================================
       KEYBOARD NAVIGATION
       ===================================================================== */
    document.addEventListener('keydown', e => {
      if (e.target.tagName === 'INPUT' || e.target.tagName === 'SELECT') return;
      const secs = ['abstract','background','questions','hypotheses','objectives','methods','workpackages','timeline','impact','resources','glossary','references'];
      const idx = secs.indexOf(State.currentSection);
      if ((e.key === 'ArrowRight' || e.key === 'j') && idx < secs.length - 1) navigateToSection(secs[idx + 1]);
      if ((e.key === 'ArrowLeft' || e.key === 'k') && idx > 0) navigateToSection(secs[idx - 1]);
    });

    /* =====================================================================
       INIT
       ===================================================================== */
    document.addEventListener('DOMContentLoaded', () => {
      initParticles();
      updateProgress();
    });
  </script>
</body>
</html>
